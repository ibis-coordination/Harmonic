<% if @current_user %>
  <article class="pulse-home">
    <header class="pulse-page-header">
      <h1 class="pulse-page-title"><span><%= @current_tenant.subdomain %><span class="pulse-subdomain-suffix">.<%= ENV['HOSTNAME'] %></span></span></h1>
    </header>

    <%# Scenes Section %>
    <%= render 'shared/pulse_accordion', title: 'Your Scenes', icon: 'eye', tooltip: 'Scenes are publicly visible groups.', count: @scenes.size, open: true do %>
      <% if @scenes.any? %>
        <% unless @current_representation_session %>
          <div class="pulse-home-section-intro">
            <a href="/scenes/new" class="pulse-action-btn-secondary">
              <%= octicon 'plus', height: 14 %>
              New Scene
            </a>
          </div>
        <% end %>

        <ul class="pulse-home-list" style="list-style-type: none;">
          <% @scenes.each do |scene| %>
            <li class="pulse-home-list-item" style="list-style-type: none;">
              <a href="<%= scene.path %>" class="pulse-home-list-link">
                <% if scene.image.attached? %>
                  <img src="<%= scene.image_path %>" alt="" class="pulse-home-list-icon">
                <% else %>
                  <span class="pulse-home-list-icon pulse-default-icon">
                    <%= octicon 'people', height: 14 %>
                  </span>
                <% end %>
                <span class="pulse-home-list-name"><%= scene.name %></span>
              </a>
            </li>
          <% end %>
          <li class="pulse-home-list-item pulse-home-list-item-explore" style="list-style-type: none;">
            <a href="/scenes" class="pulse-home-list-link pulse-home-list-link-muted">
              <%= octicon 'telescope', height: 16 %>
              <span>Explore other scenes on <code><%= @current_tenant.subdomain %></code></span>
            </a>
          </li>
        </ul>
      <% else %>
        <div class="pulse-empty-state-action">
          <p>You haven't joined any scenes yet.</p>
          <p><a href="/scenes" class="pulse-link"><%= octicon 'telescope', height: 14 %> Explore scenes on <code><%= @current_tenant.subdomain %></code></a></p>
          <% unless @current_representation_session %>
            <a href="/scenes/new" class="pulse-action-btn-secondary">
              <%= octicon 'plus', height: 14 %>
              New Scene
            </a>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <%# Studios Section %>
    <%= render 'shared/pulse_accordion', title: 'Your Studios', icon: 'lock', tooltip: 'Studios are private groups.', count: @studios.size, open: true do %>
      <% if @studios.any? %>
        <% unless @current_representation_session %>
          <div class="pulse-home-section-intro">
            <a href="/studios/new" class="pulse-action-btn-secondary">
              <%= octicon 'plus', height: 14 %>
              New Studio
            </a>
          </div>
        <% end %>

        <ul class="pulse-home-list" style="list-style-type: none;">
          <% @studios.each do |studio| %>
            <li class="pulse-home-list-item" style="list-style-type: none;">
              <a href="<%= studio.path %>" class="pulse-home-list-link">
                <% if studio.has_heartbeat %>
                  <span class="pulse-heartbeat-icon pulse-heartbeat-sent" title="Checked in this cycle">
                    <%= octicon 'heart-fill', height: 16 %>
                  </span>
                <% else %>
                  <span class="pulse-heartbeat-icon pulse-heartbeat-pending" title="Not yet checked in this cycle">
                    <%= octicon 'heart', height: 16 %>
                  </span>
                <% end %>
                <% if studio.image.attached? %>
                  <img src="<%= studio.image_path %>" alt="" class="pulse-home-list-icon">
                <% else %>
                  <span class="pulse-home-list-icon pulse-default-icon">
                    <%= octicon 'people', height: 14 %>
                  </span>
                <% end %>
                <span class="pulse-home-list-name"><%= studio.name %></span>
              </a>
            </li>
          <% end %>
        </ul>
      <% else %>
        <div class="pulse-empty-state-action">
          <p>You're not a member of any studios yet.</p>
          <% unless @current_representation_session %>
            <a href="/studios/new" class="pulse-action-btn-secondary">
              <%= octicon 'plus', height: 14 %>
              New Studio
            </a>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <%# Subdomains Section %>
    <%= render 'shared/pulse_accordion', title: 'Your Subdomains', icon: 'globe', tooltip: 'Each subdomain contains a separate set of scenes and studios.', count: @other_tenants.size + 1, open: true do %>
      <div class="pulse-home-section-intro">
        <% if @current_tenant.is_admin?(@current_user) && @current_tenant.subdomain == ENV['PRIMARY_SUBDOMAIN'] %>
          <a href="/admin/tenants/new" class="pulse-action-btn-secondary">
            <%= octicon 'plus', height: 14 %>
            New Subdomain
          </a>
        <% else %>
          <button type="button" class="pulse-action-btn-secondary" disabled title="Adding new subdomains requires admin permissions.">
            <%= octicon 'plus', height: 14 %>
            New Subdomain
          </button>
        <% end %>
      </div>

      <ul class="pulse-home-list" style="list-style-type: none;">
        <li class="pulse-home-list-item pulse-home-list-item-current" style="list-style-type: none;">
          <span class="pulse-home-list-link">
            <code class="pulse-subdomain-code"><%= @current_tenant.subdomain %></code>
            <span class="pulse-current-badge">current</span>
          </span>
        </li>
        <% @other_tenants.each do |tenant| %>
          <li class="pulse-home-list-item" style="list-style-type: none;">
            <a href="https://<%= tenant.subdomain %>.<%= ENV['HOSTNAME'] %>" class="pulse-home-list-link">
              <code class="pulse-subdomain-code"><%= tenant.subdomain %></code>
            </a>
          </li>
        <% end %>
      </ul>
    <% end %>
  </article>
<% else %>
  <div class="pulse-empty-state" style="text-align: center; padding: 48px;">
    <p>Please <a href="/login" class="pulse-link">log in</a> to continue.</p>
  </div>
<% end %>
