<%= render 'shared/pulse_breadcrumb', items: [
  [@current_superagent.name, @current_superagent.path],
  ['Settings', @current_superagent.path + '/settings'],
  'Webhooks'
] %>

<article class="pulse-resource-detail">
  <header class="pulse-resource-header">
    <div class="pulse-resource-header-top">
      <span class="pulse-resource-type-label">
        <%= octicon 'webhook', height: 14, class: 'pulse-resource-icon' %>
        Webhooks
      </span>
    </div>
    <h1 class="pulse-resource-title">Webhooks</h1>
  </header>

  <div class="pulse-resource-body">
    <p class="pulse-action-row">
      <a href="<%= "/studios/#{@current_superagent.handle}/settings/webhooks/new" %>" class="pulse-action-btn pulse-action-btn-primary">
        <%= octicon "plus" %> New Webhook
      </a>
    </p>

    <% if @webhooks.empty? %>
      <p class="pulse-empty-content"><em>No webhooks configured yet.</em></p>
      <p>Webhooks allow external services to receive real-time notifications when events occur in this studio.</p>
    <% else %>
      <table class="pulse-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>URL</th>
            <th>Events</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @webhooks.each do |webhook| %>
            <tr>
              <td>
                <a href="<%= "/studios/#{@current_superagent.handle}/settings/webhooks/#{webhook.truncated_id}" %>" class="pulse-link">
                  <%= webhook.name %>
                </a>
              </td>
              <td class="pulse-monospace"><%= truncate(webhook.url, length: 50) %></td>
              <td>
                <% if webhook.events.include?("*") %>
                  <span class="pulse-tag">All events</span>
                <% else %>
                  <%= webhook.events.size %> event(s)
                <% end %>
              </td>
              <td>
                <% if webhook.enabled? %>
                  <span class="pulse-tag pulse-tag-success">Enabled</span>
                <% else %>
                  <span class="pulse-tag">Disabled</span>
                <% end %>
              </td>
              <td>
                <a href="<%= "/studios/#{@current_superagent.handle}/settings/webhooks/#{webhook.truncated_id}" %>" class="pulse-action-btn">
                  View
                </a>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</article>
