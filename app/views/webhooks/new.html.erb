<%= render 'shared/pulse_breadcrumb', items: [
  [@current_superagent.name, @current_superagent.path],
  ['Settings', @current_superagent.path + '/settings'],
  ['Webhooks', @current_superagent.path + '/settings/webhooks'],
  'New'
] %>

<article class="pulse-resource-detail">
  <header class="pulse-resource-header">
    <div class="pulse-resource-header-top">
      <span class="pulse-resource-type-label">
        <%= octicon 'webhook', height: 14, class: 'pulse-resource-icon' %>
        New Webhook
      </span>
    </div>
    <h1 class="pulse-resource-title">New Webhook</h1>
  </header>

  <div class="pulse-resource-body">
    <p>Webhooks allow external services to receive real-time notifications when events occur in this studio.</p>

    <form action="<%= "/studios/#{@current_superagent.handle}/settings/webhooks/new/actions/create_webhook" %>" method="post" class="pulse-form">
      <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

      <section class="pulse-settings-section">
        <label for="name" class="pulse-label">Name</label>
        <input type="text" id="name" name="name" class="pulse-form-input" placeholder="My Webhook" required>
        <small class="pulse-hint">A descriptive name for this webhook.</small>
      </section>

      <section class="pulse-settings-section">
        <label for="url" class="pulse-label">URL</label>
        <input type="url" id="url" name="url" class="pulse-form-input" placeholder="https://example.com/webhook" required>
        <small class="pulse-hint">The HTTPS URL to receive webhook payloads. Must use HTTPS.</small>
      </section>

      <section class="pulse-settings-section">
        <label for="events" class="pulse-label">Events</label>
        <select id="events" name="events" class="pulse-form-input">
          <option value="*" selected>All events</option>
          <option value="note.created,note.updated,note.deleted">Notes only</option>
          <option value="decision.created,decision.voted,decision.resolved">Decisions only</option>
          <option value="commitment.created,commitment.joined,commitment.critical_mass">Commitments only</option>
          <option value="comment.created">Comments only</option>
        </select>
        <small class="pulse-hint">Which events should trigger this webhook.</small>
      </section>

      <section class="pulse-settings-section">
        <label class="pulse-checkbox-label">
          <input type="checkbox" name="enabled" value="true" checked>
          Enable this webhook
        </label>
      </section>

      <section class="pulse-settings-section pulse-action-row">
        <button type="submit" class="pulse-action-btn pulse-action-btn-primary">Create Webhook</button>
        <a href="<%= "/studios/#{@current_superagent.handle}/settings/webhooks" %>" class="pulse-action-btn">Cancel</a>
      </section>
    </form>

    <%= render 'shared/pulse_accordion', title: 'Available Event Types', open: false do %>
      <ul class="pulse-list">
        <li class="pulse-list-item"><code>note.created</code> - A note was created</li>
        <li class="pulse-list-item"><code>note.updated</code> - A note was updated</li>
        <li class="pulse-list-item"><code>note.deleted</code> - A note was deleted</li>
        <li class="pulse-list-item"><code>decision.created</code> - A decision was created</li>
        <li class="pulse-list-item"><code>decision.voted</code> - A vote was cast on a decision</li>
        <li class="pulse-list-item"><code>decision.resolved</code> - A decision was resolved</li>
        <li class="pulse-list-item"><code>commitment.created</code> - A commitment was created</li>
        <li class="pulse-list-item"><code>commitment.joined</code> - Someone joined a commitment</li>
        <li class="pulse-list-item"><code>commitment.critical_mass</code> - A commitment reached critical mass</li>
        <li class="pulse-list-item"><code>comment.created</code> - A comment was added</li>
        <li class="pulse-list-item"><code>*</code> - All events</li>
      </ul>
    <% end %>
  </div>
</article>
