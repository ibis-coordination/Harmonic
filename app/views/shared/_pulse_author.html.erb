<%# Pulse-styled author display %>
<%# Usage: render 'shared/pulse_author', resource: @note %>
<% verb ||= nil %>
<% author = resource.created_by %>
<% representative = resource.respond_to?(:representative_user) ? resource.representative_user : nil %>
<% is_representation = resource.respond_to?(:created_via_representation?) && resource.created_via_representation? && representative %>
<% display_author = is_representation ? representative : author %>
<% if display_author %>
  <div class="pulse-feed-item-author">
    <%= render "shared/avatar", user: display_author %>
    <a href="<%= display_author.path %>" class="pulse-feed-item-author">
      <strong><%= display_author.display_name %></strong>
    </a>
    <% if is_representation %>
      <span class="pulse-representation-label">on behalf of <%= link_to author.display_name, author.path %></span>
    <% elsif author.ai_agent? && author.parent %>
      <span class="pulse-ai-agent-label">(managed by <%= link_to author.parent.display_name, author.parent.path %>)</span>
    <% end %>
    <% if verb.present? %>
      <span><%= verb %></span>
    <% end %>
    <span class="pulse-timestamp"><%= timeago(resource.created_at) %></span>
  </div>
  <%# Show task run link if the current user owns the ai_agent that created this %>
  <% if author.ai_agent? && author.parent == @current_user %>
    <% task_run = AiAgentTaskRunResource.task_run_for(resource) %>
    <% if task_run %>
      <div class="pulse-task-run-link">
        <%= octicon 'workflow', height: 12 %>
        <%= link_to "View task run", ai_agent_run_path(author.handle, task_run.id) %>
      </div>
    <% end %>
  <% end %>
  <% if resource.updated_at > resource.created_at + 1.minute %>
    <div class="pulse-feed-item-updated">
      <span>Updated <%= timeago(resource.updated_at) %></span>
      <% if resource.updated_by && resource.updated_by != author %>
        <span>by <%= link_to resource.updated_by.display_name, resource.updated_by.path %></span>
      <% end %>
    </div>
  <% end %>
<% end %>
