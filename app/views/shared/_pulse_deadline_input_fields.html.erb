<% form ||= nil # required %>
<% resource ||= nil %>
<% current_time_in_zone = @current_superagent.time_in_zone(Time.current) %>
<% deadline = deadline ? deadline : (resource ? resource.deadline : current_time_in_zone) %>
<% deadline = @current_superagent.time_in_zone(deadline) %>
<% requires_manual_close = resource ? resource.requires_manual_close? : false %>
<% closing_at_critical_mass = resource && !requires_manual_close ? resource.close_at_critical_mass? : false %>
<% close_now_option ||= false %>
<% close_at_critical_mass_option ||= false %>

<div data-controller="deadline-options" class="pulse-deadline-options">
  <fieldset class="pulse-radio-group">
    <label class="pulse-radio-label">
      <%= form.radio_button :deadline_option, 'no_deadline', checked: requires_manual_close, class: 'pulse-radio-input' %>
      <span>No deadline (must be closed manually)</span>
    </label>
    <% if close_at_critical_mass_option %>
      <label class="pulse-radio-label">
        <%= form.radio_button :deadline_option, 'close_at_critical_mass', checked: closing_at_critical_mass, class: 'pulse-radio-input' %>
        <span>Close when critical mass is reached</span>
      </label>
    <% end %>
    <label class="pulse-radio-label">
      <%= form.radio_button :deadline_option, 'datetime', checked: !requires_manual_close && !closing_at_critical_mass, class: 'pulse-radio-input' %>
      <span class="pulse-deadline-datetime-wrapper">
        <% deadline_val = requires_manual_close ? current_time_in_zone : deadline %>
        <%= form.datetime_local_field :deadline, value: deadline_val.strftime('%Y-%m-%dT%H:%M'), min: [deadline_val, current_time_in_zone].min.strftime('%Y-%m-%dT%H:%M'), class: 'pulse-form-input pulse-form-input-inline' %>
        <span class="pulse-timezone-hint"><%= @current_superagent.timezone %></span>
      </span>
    </label>
    <% if close_now_option && !resource.closed? %>
      <label class="pulse-radio-label">
        <%= form.radio_button :deadline_option, 'close_now', class: 'pulse-radio-input' %>
        <span>Close now</span>
      </label>
    <% end %>
  </fieldset>
</div>
