<% readers_title = "Readers #{octicon('book', height: 24)}".html_safe %>
<%= render 'shared/collapseable_section', title: readers_title, title_superscript: "#{@note.confirmed_reads}", header_level: 2, hidden: true do %>
  <ul>
  <% @note.history_events.includes(:user).order(happened_at: :desc).each do |event| %>
    <li>
      <a href="<%= event.user.path %>" class="user-profile-link"><%= profile_pic(event.user, size: 25) %> <%= event.user.display_name %></a>
      <%= event.description %> <strong><%= timeago(event.happened_at) %></strong>
    </li>
  <% end %>
  </ul>
<% end %>

<% comments_title = "Comments #{octicon('comment', height: 24)}".html_safe %>
<%= render 'shared/collapseable_section', title: comments_title, title_superscript: "#{@note.comment_count}", header_level: 2, hidden: true do %>
  <% if @note.comments.any? %>
    <div class="comments-list">
      <% @note.chronological_comments.each do |comment| %>
        <%= render 'shared/timeline_note', note: comment %>
      <% end %>
    </div>
  <% else %>
    <p class="no-comments">No comments yet.</p>
  <% end %>

  <div class="comment-form">
    <%= form_with url: "#{@note.path}/comments", method: :post, local: true, class: "new-comment-form" do |form| %>
      <div class="form-group">
        <%= form.text_area :text, placeholder: "Add a comment...", rows: 3, class: "form-control comment-input" %>
      </div>
      <div class="form-actions">
        <%= form.submit "Add Comment", class: "btn btn-primary btn-sm" %>
      </div>
    <% end %>
  </div>
<% end %>

<% backlinks_title = "Backlinks #{octicon('link', height: 24)}".html_safe %>
<%= render 'shared/collapseable_section', title: backlinks_title, title_superscript: "#{@note.backlinks.count}", header_level: 2, hidden: true do %>
  <ul>
    <% @note.backlinks.each do |r| %>
      <% model_name = r.class.name.downcase %>
      <li>
        <a href="<%= r.path %>">
          <i class='<%= model_name %>-icon'></i>
          <code><%= r.path_prefix %>/<%= r.truncated_id %></code>
      </li>
    <% end %>
  </ul>
<% end %>
