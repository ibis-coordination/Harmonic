<% if @current_user %>
  <% if @note_reader.confirmed_read_but_note_updated? %>
    <div class="pulse-section-label">
      <%= octicon 'book', height: 14 %>
      Confirm Read
    </div>
    <p class="pulse-confirm-message">
      Note updated since you last confirmed reading. Reconfirm to acknowledge the changes.
    </p>
    <div class="pulse-confirm-action">
      <button
        class="pulse-action-btn"
        data-action="click->note#confirm mouseenter->note#confirmButtonMouseEnter mouseleave->note#confirmButtonMouseLeave"
        data-note-target="confirmButton"
        data-url="<%= @note.path + '/confirm.html' %>"
        >
        <%= octicon 'book', height: 14 %>
        <span data-note-target="confirmButtonMessage">Confirm Read</span>
      </button>
    </div>
  <% elsif @note_reader.confirmed_read? %>
    <%= render 'history' %>
  <% else %>
    <div class="pulse-section-label">
      <%= octicon 'book', height: 14 %>
      Confirm Read
    </div>
    <p class="pulse-confirm-message">
      Confirm that you have read this note to access comments and backlinks.
    </p>
    <div class="pulse-confirm-action">
      <button
        class="pulse-action-btn"
        data-action="click->note#confirm mouseenter->note#confirmButtonMouseEnter mouseleave->note#confirmButtonMouseLeave"
        data-note-target="confirmButton"
        data-url="<%= @note.path + '/confirm.html' %>"
        >
        <%= octicon 'book', height: 14 %>
        <span data-note-target="confirmButtonMessage">Confirm Read</span>
      </button>
    </div>
  <% end %>
<% else %>
  <div class="pulse-section-label">
    <%= octicon 'book', height: 14 %>
    Confirm Read
  </div>
  <div class="pulse-auth-required">
    <%= link_to 'Log in', '/login', data: { redirect_to_resource: @note.path }, class: 'pulse-action-btn-secondary' %> to confirm reading this note.
  </div>
<% end %>
