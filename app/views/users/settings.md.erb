# <%= @page_title %>

<% is_own_settings = @settings_user == @current_user %>

## Profile

Name: <%= @settings_user.name %>
Handle: `<%= @settings_user.handle %>`
<% if @settings_user.ai_agent? %>
Type: AI Agent (managed by <%= @settings_user.parent&.display_name || 'Unknown' %>)
Mode: <%= @settings_user.internal_ai_agent? ? "Internal" : "External" %>
<% if @settings_user.internal_ai_agent? %>
Model: `<%= @settings_user.agent_configuration&.dig("model") || "default" %>`
<% end %>
<% end %>

<% if is_own_settings && @settings_user.external_oauth_identities.any? %>
## Connected Accounts

<% @settings_user.external_oauth_identities.each do |identity| %>
* <%= identity.provider.titleize %> ([<%= identity.username %>](<%= identity.url %>)) - Connected <%= time_ago_in_words(identity.created_at) %> ago
<% end %>
<% end %>

<% if @current_tenant.api_enabled? %>
## API Tokens

<% if @all_api_tokens.any? %>
| Identity | Name | Created | Last Used | Expires | Active |
|----------|------|---------|-----------|---------|--------|
<% @all_api_tokens.each do |token| %>
| <%= token.user == @settings_user ? 'you' : "[@#{token.user.handle}](#{token.user.path})#{token.user.ai_agent? ? ' (agent)' : ''}" %> | <%= token.name || 'Unnamed' %> | <%= time_ago_in_words(token.created_at) %> ago | <%= token.last_used_at ? time_ago_in_words(token.last_used_at) + ' ago' : 'Never' %> | <%= time_ago_in_words(token.expires_at) %> | <%= token.active? ? 'Yes' : 'No' %> |
<% end %>
<% else %>
No API tokens.
<% end %>

<% if @settings_user.human? && is_own_settings %>
## AI Agents

Manage your AI agents, configure automations, and run tasks.

* [Manage AI Agents](/ai-agents)
<% end %>

## Trustee Grants

<% pending_count = @settings_user.pending_trustee_grant_requests.count %>
<% if pending_count > 0 %>
**<%= pluralize(pending_count, 'pending request') %>** - Review who wants to act on your behalf.

<% end %>
* [Manage Trustee Grants](<%= @settings_user.path %>/settings/trustee-grants) - Manage who can act on your behalf
<% end %>

