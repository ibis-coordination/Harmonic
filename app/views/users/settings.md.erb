# <%= @page_title %>

<% is_own_settings = @settings_user == @current_user %>

## Profile

Name: <%= raw @settings_user.name %>
Handle: `<%= @settings_user.handle %>`
<% if @settings_user.ai_agent? %>
Type: AI Agent (managed by <%= @settings_user.parent&.display_name || 'Unknown' %>)
Mode: <%= @settings_user.internal_ai_agent? ? "Internal" : "External" %>
<% if @settings_user.internal_ai_agent? %>
Model: `<%= @settings_user.agent_configuration&.dig("model") || "default" %>`
<% end %>
<% end %>

<% if is_own_settings && @settings_user.external_oauth_identities.any? %>
## Connected Accounts

<% @settings_user.external_oauth_identities.each do |identity| %>
* <%= identity.provider.titleize %> ([<%= identity.username %>](<%= identity.url %>)) - Connected <%= time_ago_in_words(identity.created_at) %> ago
<% end %>
<% end %>

<% if @current_tenant.api_enabled? %>
## API Tokens

<% if @settings_user.api_tokens.external.any? %>
| Name | Created | Last Used | Expires | Active |
|------|---------|-----------|---------|--------|
<% @settings_user.api_tokens.external.each do |token| %>
| <%= raw token.name || 'Unnamed' %> | <%= time_ago_in_words(token.created_at) %> ago | <%= token.last_used_at ? time_ago_in_words(token.last_used_at) + ' ago' : 'Never' %> | <%= time_ago_in_words(token.expires_at) %> | <%= token.active? ? 'Yes' : 'No' %> |
<% end %>
<% else %>
No API tokens.
<% end %>

<% if @settings_user.human? && is_own_settings && @ai_agents.any? %>
## AI Agents

<% @ai_agents.each do |ai_agent| %>
### <%= raw ai_agent.name %><%= ai_agent.archived? ? ' (Archived)' : '' %>

* [View Profile](<%= ai_agent.path %>)
* [Settings](<%= ai_agent.path %>/settings)
* Created <%= time_ago_in_words(ai_agent.created_at) %> ago
<% active_studios = ai_agent.superagent_members.reject(&:archived?).map(&:superagent).reject { |s| s == @current_tenant.main_superagent } %>
<% if active_studios.any? %>

Studio memberships:
<% active_studios.each do |s| %>
* [<%= raw s.name %>](<%= s.path %>)
<% end %>
<% end %>
<% end %>
<% end %>

## Trustee Grants

<% pending_count = @settings_user.pending_trustee_grant_requests.count %>
<% if pending_count > 0 %>
**<%= pluralize(pending_count, 'pending request') %>** - Review who wants to act on your behalf.

<% end %>
* [Manage Trustee Grants](<%= @settings_user.path %>/settings/trustee-grants) - Manage who can act on your behalf
<% end %>

## [Actions](<%= @settings_user.path %>/settings/actions)

* [`update_profile(name, new_handle)`](<%= @settings_user.path %>/settings/actions/update_profile) - Update profile name and/or handle
<% if @current_tenant.api_enabled? %>
<% if @current_user.human? %>
* [New API Token](<%= @settings_user.path %>/settings/tokens/new) - Create a new API token
<% end %>
* [Webhooks](<%= @settings_user.path %>/settings/webhooks) - Manage personal webhooks for reminders and notifications
<% if @current_user.human? && is_own_settings %>
* [New AI Agent](<%= @settings_user.path %>/settings/ai-agents/new) - Create a new AI agent
<% end %>
<% end %>
