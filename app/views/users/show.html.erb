<%= render 'shared/pulse_breadcrumb', items: [
  [@current_tenant.subdomain, '/'],
  'Users',
  @showing_user.display_name
] %>

<article class="pulse-user-profile">
  <header class="pulse-user-header">
    <div class="pulse-user-avatar-large">
      <img src="<%= @showing_user.image_url %>" alt="<%= @showing_user.display_name %>" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
    </div>
    <div class="pulse-user-info">
      <h1 class="pulse-user-name">
        <%= @showing_user.display_name %>
        <% if @showing_user.archived? %>
          <span class="pulse-badge pulse-badge-muted">Archived</span>
        <% end %>
      </h1>
      <p class="pulse-user-handle">@<%= @showing_user.handle %></p>
      <% if @showing_user.ai_agent? %>
        <span class="pulse-badge" title="This is a ai_agent managed by <%= @showing_user.parent&.display_name %>">ai_agent</span>
      <% end %>
    </div>
    <% if @current_user.can_edit?(@showing_user) %>
      <div class="pulse-user-actions">
        <a href="<%= @showing_user.path %>/settings" class="pulse-action-btn">
          <%= octicon 'gear', height: 14 %>
          Settings
        </a>
      </div>
    <% end %>
  </header>

  <% if @showing_user.ai_agent? && @showing_user.parent %>
    <div class="pulse-user-parent-info">
      <span style="color: var(--color-fg-muted);">Managed by</span>
      <a href="<%= @showing_user.parent.path %>" class="pulse-user-parent-link">
        <%= profile_pic(@showing_user.parent, size: 20, style: 'vertical-align:middle;margin-right:4px;border-radius:50%;') %>
        <strong><%= @showing_user.parent.display_name %></strong>
      </a>
    </div>
  <% end %>

  <% if @showing_user.human? && @ai_agent_count && @ai_agent_count > 0 %>
    <div class="pulse-user-ai_agent-count">
      <%= octicon 'people', height: 14 %>
      Has <%= @ai_agent_count %> ai_agent<%= @ai_agent_count == 1 ? "" : "s" %>
    </div>
  <% end %>

  <% if @current_user != @showing_user && (@common_studio_count > 0 || @common_scene_count > 0) %>
    <div class="pulse-user-common-counts">
      <% if @common_scene_count > 0 %>
        <span class="pulse-common-count-item">
          <%= octicon 'eye', height: 14 %>
          <%= @common_scene_count %> common scene<%= 's' unless @common_scene_count == 1 %>
        </span>
      <% end %>
      <% if @common_studio_count > 0 %>
        <span class="pulse-common-count-item">
          <%= octicon 'lock', height: 14 %>
          <%= @common_studio_count %> common studio<%= 's' unless @common_studio_count == 1 %>
        </span>
      <% end %>
    </div>
  <% end %>

  <% if @current_user != @showing_user && @common_studios.count > 0 %>
    <%# Common Studios Section %>
    <%= render 'shared/pulse_accordion', title: 'Common Studios', count: @common_studios.count + @additional_common_studio_count, open: true do %>
      <div class="pulse-studios-list">
        <% @common_studios.each do |studio| %>
          <div class="pulse-studio-item">
            <div class="pulse-author-avatar">
              <img src="<%= studio.image_path %>" alt="<%= studio.name %>" style="width:100%;height:100%;object-fit:cover;border-radius:6px;">
            </div>
            <div class="pulse-studio-info">
              <a href="<%= studio.path %>" class="pulse-studio-name"><%= studio.name %></a>
            </div>
          </div>
        <% end %>
        <% if @additional_common_studio_count > 0 %>
          <p class="pulse-form-hint">and <%= @additional_common_studio_count %> more...</p>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <% if @proximity_users.present? %>
    <%= render 'shared/pulse_accordion', title: 'Social Proximity', count: @proximity_users.size, icon: 'people', open: true do %>
      <%= render 'users/proximity_connections' %>
    <% end %>
  <% end %>
</article>
