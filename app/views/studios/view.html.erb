<%= render 'shared/pulse_breadcrumb', items: [
  [@current_collective.name, @current_collective.path],
  ['Views', @current_collective.path + '/views'],
  'View'
] %>

<article class="pulse-resource-detail">
  <header class="pulse-resource-header">
    <div class="pulse-resource-header-top">
      <span class="pulse-resource-type-label">
        <%= octicon 'table', height: 14, class: 'pulse-resource-icon' %>
        View
      </span>
    </div>
    <h1 class="pulse-resource-title">Custom View</h1>
  </header>

  <div class="pulse-resource-body">
    <section class="pulse-settings-section">
      <span data-controller="cycle-filters">
        <%= form_with url: "#{@current_collective.path}/view", method: :get, local: true, id: 'sort-filter-form', class: 'pulse-form pulse-filters-form' do |form| %>
          <div class="pulse-form-row">
            <div class="pulse-form-group">
              <label class="pulse-form-label">Cycle</label>
              <%= form.select :cycle, options_for_select(@cycle.cycle_options, @cycle.name), {}, { id: 'cycle-select', class: 'pulse-form-select' } %>
            </div>
            <div class="pulse-form-group">
              <label class="pulse-form-label">Filter</label>
              <%= form.select :filter, options_for_select(@filter_options, @filters), {}, { id: 'filter-select', class: 'pulse-form-select' } %>
            </div>
            <div class="pulse-form-group">
              <label class="pulse-form-label">Sort By</label>
              <%= form.select :sort_by, options_for_select(@sort_by_options, @sort_by), {}, { id: 'sort-select', class: 'pulse-form-select' } %>
            </div>
            <div class="pulse-form-group">
              <label class="pulse-form-label">Group By</label>
              <%= form.select :group_by, options_for_select(@group_by_options, @group_by), {}, { id: 'group-select', class: 'pulse-form-select' } %>
            </div>
            <div class="pulse-form-group pulse-form-group-submit">
              <%= form.submit 'Apply', class: 'pulse-action-btn' %>
            </div>
          </div>
        <% end %>
      </span>
    </section>

    <section class="pulse-settings-section">
      <% selections = @cycle.selections %>
      <% @grouped_rows.each do |group_rows| %>
        <% group, rows = group_rows %>
        <%= render 'shared/pulse_accordion', title: group, open: true, count: rows.length do %>
          <table class="pulse-table">
            <thead>
              <tr>
                <% selections.each do |selection| %>
                  <th><%= selection.titleize %></th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <% rows.each do |row| %>
                <tr>
                  <% row.each do |cell| %>
                    <td><%= cell %></td>
                  <% end %>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
      <% end %>
    </section>
  </div>
</article>
