<% if @commitment.closed? && @current_user %>
  <% if @commitment_participant.committed? %>
    <p class="pulse-join-status">
      <button class="pulse-action-btn pulse-action-btn-disabled" disabled>
        <%= octicon 'check', height: 14 %>
        Joined
      </button>
      <span class="pulse-join-message">Your participation has been recorded.</span>
    </p>
  <% else %>
    <p class="pulse-join-closed">This commitment is closed.</p>
  <% end %>
<% elsif @commitment.closed? %>
  <p class="pulse-join-closed">This commitment is closed.</p>
<% elsif @current_user %>
  <% if @commitment_participant.committed? %>
    <p class="pulse-join-status">
      <button class="pulse-action-btn pulse-action-btn-disabled" disabled>
        <%= octicon 'check', height: 14 %>
        Joined
      </button>
      <span class="pulse-join-message">Your participation has been recorded.</span>
    </p>
  <% else %>
    <p class="pulse-join-action">
      <button
        class="pulse-action-btn"
        data-action="click->commitment#join mouseenter->commitment#joinButtonMouseEnter mouseleave->commitment#joinButtonMouseLeave"
        data-commitment-target="joinButton"
        data-url="<%= @commitment.path + '/join.html' %>"
        >
        <%= octicon 'person-add', height: 14 %>
        Join
      </button>
      <span class="pulse-join-message" data-commitment-target="joinButtonMessage">
        Your participation will be visible to all members of <%= @current_collective.name %>.
      </span>
    </p>
  <% end %>
  <p class="pulse-join-info">
    Commitments only take effect if critical mass is achieved.
    <%= render 'reciprocal_commitment_tooltip' %>
  </p>
<% else %>
  <div class="auth-required-message">
    <%= button_to 'Log in', '/login', method: :get, data: { redirect_to_resource: @commitment.path } %> to join this commitment.
  </div>
<% end %>
