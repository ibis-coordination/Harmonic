<%= render 'shared/pulse_breadcrumb', items: [
  [@current_collective.name, @current_collective.path],
  'New'
] %>

<%= render 'shared/pulse_create_tabs', current: :commitment %>

<article class="pulse-resource-detail">

  <%= form_with(url: "#{@current_collective.path}/commit", class: "pulse-form") do |form| %>
    <div class="pulse-form-group">
      <label class="pulse-form-label">Title</label>
      <%= form.text_field :title,
          placeholder: "What action will this commitment initiate?",
          class: "pulse-form-input",
          autofocus: true %>
    </div>

    <div class="pulse-form-group">
      <label class="pulse-form-label">Description <span class="pulse-form-label-optional">(optional)</span></label>
      <div class="mention-autocomplete-container" data-controller="mention-autocomplete" data-mention-autocomplete-studio-path-value="<%= @current_collective.path %>">
        <%= form.text_area :description,
            placeholder: "Describe what participants are committing to... (markdown supported, use @ to mention users)",
            class: "pulse-form-textarea",
            rows: 4,
            data: { mention_autocomplete_target: "input" } %>
        <div data-mention-autocomplete-target="dropdown" class="mention-dropdown"></div>
      </div>
    </div>

    <%= render 'shared/multi_file_select', form: form %>

    <section class="pulse-form-section">
      <h2 class="pulse-section-title">Critical Mass</h2>
      <p class="pulse-section-description">
        How many participants are required for this commitment to take effect?
      </p>
      <div class="pulse-form-group">
        <div class="pulse-inline-field">
          <span>At least</span>
          <%= form.number_field :critical_mass, value: 1, min: 1, class: 'pulse-form-input pulse-form-input-narrow' %>
          <span>participant(s) required</span>
        </div>
      </div>
    </section>

    <section class="pulse-form-section">
      <h2 class="pulse-section-title">Deadline</h2>
      <p class="pulse-section-description">When must critical mass be reached?</p>
      <%= render 'shared/pulse_deadline_input_fields', form: form, deadline: Time.current + 1.week, close_at_critical_mass_option: true %>
    </section>

    <div class="pulse-form-actions">
      <%= form.submit 'Start Commitment', class: 'pulse-action-btn' %>
      <span class="pulse-visibility-hint">
        <% if @current_collective.is_scene? %>
          <%= octicon 'eye', height: 14 %>
          Commitments posted in scenes are publicly visible.
        <% else %>
          <%= octicon 'lock', height: 14 %>
          Only members of this studio can access this commitment.
        <% end %>
      </span>
    </div>
  <% end %>
</article>
