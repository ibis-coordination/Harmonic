<div class="pulse-auth-page">
  <div class="pulse-auth-logo">
    <i class="tri-logo-icon icon-lg"></i>
  </div>

  <h1 class="pulse-auth-title">Set Up Two-Factor Authentication</h1>

  <p class="pulse-auth-subtitle">
    Scan this QR code with your authenticator app
    <br>(Google Authenticator, Authy, 1Password, etc.)
  </p>

  <% if flash[:alert] %>
    <div class="pulse-alert" style="margin-bottom: 16px;">
      <%= flash[:alert] %>
    </div>
  <% end %>

  <div class="two-factor-qr-code" style="background: white; padding: 16px; border-radius: 8px; display: inline-block; margin: 24px 0;">
    <%= @qr_code.html_safe %>
  </div>

  <details style="margin-bottom: 24px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto;">
    <summary style="cursor: pointer; color: var(--color-fg-muted);">
      Can't scan the code?
    </summary>
    <p style="margin-top: 12px; color: var(--color-fg-muted); font-size: 0.875rem;">
      Enter this key manually in your authenticator app:
    </p>
    <code class="pulse-code" style="display: block; margin-top: 8px; padding: 12px; word-break: break-all; font-size: 0.875rem;">
      <%= @secret %>
    </code>
  </details>

  <p class="pulse-auth-subtitle">
    Enter the 6-digit code from your authenticator app to confirm setup.
  </p>

  <%= form_with url: two_factor_confirm_path, method: :post, class: "pulse-auth-form" do |form| %>
    <%= form.text_field :code,
        placeholder: 'Enter 6-digit code',
        class: 'pulse-form-input',
        autocomplete: 'one-time-code',
        inputmode: 'numeric',
        pattern: '[0-9]{6}',
        maxlength: 6,
        autofocus: true,
        style: 'text-align: center; font-size: 1.25rem; letter-spacing: 0.25em;' %>

    <div class="pulse-form-actions" style="margin-top: 16px;">
      <%= submit_tag "Enable Two-Factor Authentication", class: "pulse-action-btn", style: "width: 100%;" %>
    </div>
  <% end %>

  <div class="pulse-auth-footer" style="margin-top: 24px;">
    <%= link_to 'Cancel', "/u/#{@current_user.handle}/settings", class: 'pulse-auth-link' %>
  </div>
</div>
