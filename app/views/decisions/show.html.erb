<span data-controller="decision" data-decision-id="<%= @decision.id %>">
<%= render 'shared/pulse_breadcrumb', items: [
  [@current_collective.name, @current_collective.path],
  'Decision'
] %>

<article class="pulse-resource-detail">
  <header class="pulse-resource-header">
    <div class="pulse-resource-header-top">
      <span class="pulse-resource-type-label">
        <i class="decision-icon icon-sm"></i>
        Decision
        <% if @decision.closed? %>
          <span class="pulse-status-badge pulse-status-closed">Closed</span>
        <% else %>
          <span class="pulse-status-badge pulse-status-open">Open</span>
        <% end %>
      </span>
      <div class="pulse-resource-actions">
        <%= render 'shared/copy_to_clipboard', text: request.original_url %>
        <%= render 'shared/pulse_pin_button', resource: @decision, is_pinned: @is_pinned %>
        <% if @decision.can_edit_settings?(@current_user) %>
          <%= link_to "#{@decision.path}/settings", class: 'pulse-action-btn' do %>
            <%= octicon 'gear', height: 14 %>
            Settings
          <% end %>
        <% end %>
      </div>
    </div>
    <h1 class="pulse-resource-title"><%= @decision.question %></h1>
  </header>

  <div class="pulse-resource-meta">
    <%= render 'shared/pulse_author', resource: @decision %>
    <div class="pulse-deadline-info">
      <%= render 'shared/deadline_display', resource: @decision %>
    </div>
  </div>

  <%= render 'shared/automation_attribution', resource: @decision %>

  <%= render 'shared/pulse_attachments', resource: @decision %>

  <% if @decision.description.present? %>
    <div class="pulse-resource-body">
      <div class="pulse-markdown-content">
        <%= markdown(@decision.description) %>
      </div>
    </div>
  <% end %>

  <%# Voting Options Section (shown when decision is open) %>
  <% unless @decision.closed? %>
    <div class="pulse-acceptance-voting-section">
      <%= render 'shared/pulse_accordion', title: @options_header, open: true do %>
        <%= render 'options_section' %>
      <% end %>
    </div>
  <% end %>

  <%# Results Section %>
  <span
    data-controller="decision-results"
    data-decision-results-url-value="<%= @decision.path %>/results.html"
    >
    <div class="pulse-results-table-section">
      <%= render 'shared/pulse_accordion', title: @results_header, open: @decision.closed?, title_data: { 'decision-results-target': 'header' } do %>
        <span data-decision-results-target="content">
          <%= render 'results' %>
        </span>
      <% end %>
    </div>
  </span>

  <%# Voters Section %>
  <span
    data-controller="decision-voters"
    data-decision-voters-url-value="<%= @decision.path %>/voters.html"
    >
    <%= render 'voters' %>
  </span>

  <%= render 'shared/pulse_comments', commentable: @decision %>
  <%= render 'shared/pulse_backlinks', resource: @decision %>
</article>
</span>
