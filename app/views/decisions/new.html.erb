<%= render 'shared/pulse_breadcrumb', items: [
  [@current_collective.name, @current_collective.path],
  'New'
] %>

<%= render 'shared/pulse_create_tabs', current: :decision %>

<article class="pulse-resource-detail">

  <%= form_with(url: "#{@current_collective.path}/decide", class: "pulse-form") do |form| %>
    <div class="pulse-form-group">
      <label class="pulse-form-label">Question</label>
      <%= form.text_field :question,
          placeholder: "What question will this decision answer?",
          value: @decision.question,
          class: "pulse-form-input",
          autofocus: true %>
    </div>

    <div class="pulse-form-group">
      <label class="pulse-form-label">Description <span class="pulse-form-label-optional">(optional)</span></label>
      <div class="mention-autocomplete-container" data-controller="mention-autocomplete" data-mention-autocomplete-studio-path-value="<%= @current_collective.path %>">
        <%= form.text_area :description,
            placeholder: "Add context or background for this decision... (use @ to mention users)",
            value: @decision.description,
            class: "pulse-form-textarea",
            rows: 4,
            data: { mention_autocomplete_target: "input" } %>
        <div data-mention-autocomplete-target="dropdown" class="mention-dropdown"></div>
      </div>
    </div>

    <%= render 'shared/multi_file_select', form: form %>

    <section class="pulse-form-section">
      <h2 class="pulse-section-title">Options</h2>
      <p class="pulse-section-description">Who can add options to this decision?</p>
      <div class="pulse-form-group">
        <%= form.select :options_open,
            options_for_select([['Everyone', true], ['Just me', false]], selected: 'Everyone'),
            {},
            class: 'pulse-form-select pulse-form-select-narrow' %>
      </div>
    </section>

    <section class="pulse-form-section">
      <h2 class="pulse-section-title">Deadline</h2>
      <p class="pulse-section-description">When should voting close?</p>
      <%= render 'shared/pulse_deadline_input_fields', form: form, deadline: Time.current + 1.week %>
    </section>

    <div class="pulse-form-actions">
      <%= form.submit 'Start Decision', class: 'pulse-action-btn' %>
      <span class="pulse-visibility-hint">
        <% if @current_collective.is_scene? %>
          <%= octicon 'eye', height: 14 %>
          Decisions posted in scenes are publicly visible.
        <% else %>
          <%= octicon 'lock', height: 14 %>
          Only members of this studio can access this decision.
        <% end %>
      </span>
    </div>
  <% end %>
</article>
